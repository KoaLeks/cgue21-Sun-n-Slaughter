#version 430 core

 
layout (quads, fractional_odd_spacing, ccw) in;
 
in vec4 tcPosition[];

uniform mat4 modelMatrix;
uniform mat4 viewProjMatrix;
uniform sampler2D heightMap;


void main()
{
    vec4 adPosition = mix(tcPosition[0], tcPosition[3], gl_TessCoord.x);
    vec4 bcPosition = mix(tcPosition[1], tcPosition[2], gl_TessCoord.x);

    vec4 abPosition = mix(tcPosition[0], tcPosition[1], gl_TessCoord.y);
    vec4 dcPosition = mix(tcPosition[3], tcPosition[2], gl_TessCoord.y);

    vec4 position = mix(adPosition, bcPosition, gl_TessCoord.y);

    // je größer die division desto größer die map
    vec2 textureCoordinate = position.xz / 2000;

    float height = texture(heightMap, textureCoordinate).r * 250;
    vec4 newPos = vec4(position.x, height, position.z, 1.0);
	mat4 mvp = viewProjMatrix * modelMatrix;

    gl_Position = mvp * newPos;
}